---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Sign In - TypaVibe">
  <main>
    <div class="auth-container">
      <h1>Welcome to TypaVibe</h1>
      <p class="subtitle">Create and share curated product collections</p>
      
      <div class="auth-options">
        <div class="auth-option">
          <h3>üéØ Quick Start (Anonymous)</h3>
          <p>Create collections instantly without an account</p>
          <button onclick="window.location.href='/create'" class="btn-primary">
            Start Creating
          </button>
        </div>
        
        <div class="auth-divider">
          <span>or</span>
        </div>
        
        <div class="auth-option">
          <h3>üë§ Sign In</h3>
          <p>Save your collections and access them anywhere</p>
          
          <form id="auth-form">
            <input 
              id="email" 
              type="email" 
              placeholder="Enter your email" 
              required 
            />
            <button type="submit" class="btn-primary">
              Send Magic Link
            </button>
          </form>
          
          <div id="auth-message" class="auth-message" style="display: none;"></div>
        </div>
      </div>
      
      <div class="auth-footer">
        <p>Already have an account? <a href="/dashboard">Go to Dashboard</a></p>
      </div>
    </div>
  </main>
</Layout>

<script>
  import { supabase } from '../lib/supabase.js';
  
  document.getElementById('auth-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('email').value;
    const messageDiv = document.getElementById('auth-message');
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    
    try {
      submitBtn.textContent = 'Sending...';
      submitBtn.disabled = true;
      
      const { error } = await supabase.auth.signInWithOtp({
        email: email,
        options: {
          emailRedirectTo: `${window.location.origin}/dashboard`
        }
      });
      
      if (error) {
        throw error;
      }
      
      messageDiv.textContent = '‚úÖ Magic link sent! Check your email.';
      messageDiv.className = 'auth-message success';
      messageDiv.style.display = 'block';
      
      // Clear form
      document.getElementById('email').value = '';
      
    } catch (error) {
      console.error('Auth error:', error);
      messageDiv.textContent = `‚ùå ${error.message}`;
      messageDiv.className = 'auth-message error';
      messageDiv.style.display = 'block';
    } finally {
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    }
  });
</script>

<style>
  .auth-container {
    max-width: 480px;
    margin: 0 auto;
    text-align: center;
  }
  
  .subtitle {
    color: var(--color-text-secondary);
    margin-bottom: 48px;
  }
  
  .auth-options {
    display: flex;
    flex-direction: column;
    gap: 32px;
  }
  
  .auth-option {
    background: var(--color-background-secondary);
    border: 1.5px solid var(--color-border);
    border-radius: var(--radius);
    padding: 32px;
    text-align: center;
  }
  
  .auth-option h3 {
    margin-bottom: 8px;
  }
  
  .auth-option p {
    color: var(--color-text-secondary);
    margin-bottom: 24px;
  }
  
  .auth-divider {
    position: relative;
    text-align: center;
    margin: 16px 0;
  }
  
  .auth-divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--color-border);
  }
  
  .auth-divider span {
    background: var(--color-background);
    padding: 0 16px;
    color: var(--color-text-secondary);
    font-size: 14px;
  }
  
  .auth-message {
    margin-top: 16px;
    padding: 12px 16px;
    border-radius: var(--radius-sm);
    font-size: 14px;
  }
  
  .auth-message.success {
    background: #dcfce7;
    color: #166534;
    border: 1px solid #bbf7d0;
  }
  
  .auth-message.error {
    background: #fef2f2;
    color: #dc2626;
    border: 1px solid #fecaca;
  }
  
  .auth-footer {
    margin-top: 32px;
    padding-top: 24px;
    border-top: 1px solid var(--color-border);
  }
  
  .auth-footer a {
    color: var(--color-accent);
    text-decoration: none;
    font-weight: 500;
  }
  
  .auth-footer a:hover {
    text-decoration: underline;
  }
</style> 